<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        canvas {
            border: 1px solid #000000;
            cursor: default;
        }

        input {
            width: 515px;
        }

        .left {
            float: left;
            width: 515px;
        }

        .right {
            margin-left: 515px;
        }

    </style>


    <script src="//code.jquery.com/jquery-2.1.4.js"></script>
    <script src="jcanvas.js"></script>
    <script src="jchessboard.js"></script>
    <script src="jchessengine.js"></script>

</head>
<body>
<div>
<div class="left">
    <canvas width="512" height="512">
    </canvas>
    <button id="think_n_move">think & move</button>
</div>
<div class="right">
    <div id="fen"></div>
</div>
<script>

    var problems = [
        // two steps
        'k7/1R6/nK6/8/8/8/8/8 w -',
        '7k/7b/5Kp1/8/8/8/8/5Q2 w -',

        // three steps
        'k2N4/7R/8/4K3/8/8/8/8 w -',
//        '8/8/8/8/8/8/8/8 w -'

        '2bqkb2/1ppp1pp1/8/8/8/8/1PP1PPP1/2BQKB2 w KQkq'
    ];

    var canvas = $('canvas').jschessboard({numbers: true, numbersType: 'number'});
    var board = canvas.board;
    var eventDispatcher = board.eventDispatcher;

    eventDispatcher.addEventListener('board_checkmate_detected', function (event) {
        alert('Checkmate');
    });

    eventDispatcher.addEventListener('board_pawn_promotion', function (event) {
        board.onPawnPromotion(event.subject, 'q');
    });

    var problem = parseInt(localStorage.getItem('problem'));
    if (problem < problems.length - 1) {
        problem += 1;
    } else {
        problem = 0;
    }
    localStorage.setItem('problem', problem);

    board.fenToPosition(problems[problem]);

    var engine = new JChessEngine(board, 'w', 3);

    $('#think_n_move').click(function () {

        var choice = engine.think();

        board.move(choice);

    });
//
//    eventDispatcher.addEventListener('board_post_piece_move', function (event) {
//        $('#thinking').show();
//        setTimeout(function () {
//            if (engine.side !== event.subject.board.nextStepSide) {
//                return;
//            }
//            var nextStep = engine.think();
//
//            if (nextStep !== null) {
//                board.move(nextStep['currentPosition'], nextStep['possiblePosition']);
//            } else {
//                alert('Game over');
//            }
//            $('#thinking').hide();
//        }, 500);
//    });

</script>

</body>
</html>
